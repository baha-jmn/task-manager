<div class="container py-4">
  <h1 class="mb-4">Task Management</h1>

  <!-- Filters -->
  <div class="card p-3 mb-4 shadow-sm">
    <div class="row g-3">
      
      <div class="col-md-2">
        <input
          type="text"
          [(ngModel)]="searchText"
          (input)="applyFilters()"
          class="form-control"
          placeholder="Search tasks..."
        />
      </div>
      
      <div class="col-md-2">
        <select [(ngModel)]="statusFilter" (change)="applyFilters()" class="form-select">
          <option value="">All Status</option>
          <option value="TODO">TODO</option>
          <option value="IN_PROGRESS">In Progress</option>
          <option value="DONE">Done</option>
        </select>
      </div>

      <div class="col-md-1">
        <select [(ngModel)]="priorityFilter" (change)="applyFilters()" class="form-select">
          <option value="">All Priorities</option>
          @for (p of priorities; track p) {
            <option [value]="p">{{ p }}</option>
          }
        </select>
      </div>

      <div class="col-md-2">
        <input
          type="date"
          [(ngModel)]="dueDateFrom"
          (change)="applyFilters()"
          class="form-control"
        />
      </div>

      <div class="col-md-2">
        <input
          type="date"
          [(ngModel)]="dueDateTo"
          (change)="applyFilters()"
          class="form-control"
        />
      </div>

      <div class="col-md-1">
        <select [(ngModel)]="sortBy" (change)="applyFilters()" class="form-select">
          <option value="">Sort By</option>
          <option value="dueDate">Due Date</option>
          <option value="priority">Priority</option>
        </select>
      </div>

      <div class="col-md-2 d-flex gap-2">
        <button class="btn btn-secondary" (click)="resetFilters()">
          <i class="fas fa-rotate-left"></i>
        </button>

        <button class="btn btn-primary" (click)="createTask()">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Tasks Table -->
  <div class="table-responsive">
    <table class="table table-striped table-hover shadow-sm">
      <thead class="table-light">
        <tr>
          <th>Title</th>
          <th>Status</th>
          <th>Priority</th>
          <th>Due Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (task of tasks(); track task) {
          <tr>
            <td>{{ task.title }}</td>
            <td>
              <span class="badge"
                    [ngClass]="{
                      'bg-primary': task.status === 'TODO',
                      'bg-warning': task.status === 'IN_PROGRESS',
                      'bg-success': task.status === 'DONE'
                    }">
                {{ task.status }}
              </span>
            </td>
            <td>{{ task.priority }}</td>
            <td>{{ task.dueDate | date:'dd/MM/yyyy' }}</td>
            <td>
              <button class="btn btn-sm btn-primary me-1" (click)="editTask(task)">Edit</button>
              <button class="btn btn-sm btn-danger" (click)="deleteTask(task.id)">Delete</button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  @if (isLoading()) {
    <app-loader></app-loader>
  }

  <app-modal
    [title]="'Edit Task'"
    [isOpen]="showTaskForm()"
    (close)="showTaskForm.set(false)"
  >
    <app-task-form
      [task]="selectedTask"
      (submit)="onTaskFormSubmit($event)"
    ></app-task-form>
  </app-modal>
</div>
